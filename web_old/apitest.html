
<html>
	<head>
		<title></title>
		<script type="text/javascript" src="script/jquery/jquery-1.6.1.js"></script>
		<script type="text/javascript" src="script/jquery/jquery.base64.js"></script>
		<script type="text/javascript" src="script/MainScript.js"></script>
		<script type="text/javascript">
			$(document).ready(function () {
			});

			// found this very helpful for generating my test signatures.
			// http://hash.online-convert.com/sha256-generator
			
			function HelloWorld()
			{	
				$("#result").text("");
				var key = $("#key").val(); //0002bdaf-bfd5-4b9d-82d1-fd39c2947d19
				
				$.ajax({
					async: false,
					type: "POST",
					url: "pages/api.ashx?action=HelloWorld&key=" + key + "&timestamp=2011-12-20T13%3A58%3A14&signature=12f00fdafba39f5e108cf6154d68feaf2000877770fbb2aff14c1cc3ac8508ff",
					data: '',
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					success: function (msg) {
						$("#result").text(msg.d);
					},	
					error: function (response) {
						$("#result").text(response.responseText);
					}
				});
			}
			
			function GetTask()
			{	
				$("#result").text("");
			
				var key = $("#key").val();
				var task_id = $("#get_task_id").val();
			
				$.ajax({
					async: false,
					type: "POST",
					url: "pages/api.ashx?action=GetTask&key=" + key + "&timestamp=2011-12-20T13%3A58%3A14&signature=b3d3e6a85d1a23e1d7b286ce0c8de16dfcfd194ddd936b5913c2efcd437a43f7",
					data: 'TaskID=' + task_id,
					dataType: "json",
					success: function (msg) {
						$("#result").text(msg.d);
					},	
					error: function (response) {
						$("#result").text(response.responseText);
					}
				});
			}
			
			function StopTask()
			{	
				$("#result").text("");
			
				var key = $("#key").val();
				var task_instance =  $("#stop_task_instance").val();
			
				$.ajax({
					async: false,
					type: "POST",
					url: "pages/api.ashx?action=StopTask&key=" + key + "&timestamp=2011-12-20T13%3A58%3A14&signature=b3d3e6a85d1a23e1d7b286ce0c8de16dfcfd194ddd936b5913c2efcd437a43f7",
					data: 'Instance=' + task_instance,
					dataType: "json",
					success: function (msg) {
						$("#result").text(msg.d);
					},	
					error: function (response) {
						$("#result").text(response.responseText);
					}
				});
			}
			
			function RunTask()
			{	
				$("#result").text("");
			
				var key = $("#key").val();	
				var task_id = '545b60a5-17e7-4fe0-b28f-7c4722c76544';
				
				//parameters can also be provided as an argument to the run task command.
				//it is not required for parameters provided here to actually be defined on the task - but it's nice for the gui user if you're thorough
				var parameter_xml = packJSON('<parameters>' +
				'<parameter required="false" encrypt="false">' +
				'<name>single</name>' +
				'<desc />' +
				'<values present_as="value">' +
				'<value>woot</value>' +
				'</values>' +
				'</parameter>' +
				'</parameters>');
			
				$.ajax({
					async: false,
					type: "POST",
					url: "pages/api.ashx?action=RunTask&key=" + key + "&timestamp=2011-12-20T13%3A58%3A14&signature=3c6214ec866b1e0440da9bf81e9f6c06d5ff0418321b08192634d299ee67e982",
					data: 'TaskID=' + task_id + '&AssetID=&AccountID=&EcosystemID=&DebugLevel=4&ParameterXML=' + parameter_xml,
					dataType: "json",
					success: function (msg) {
						$("#result").text(msg.d);
					},	
					error: function (response) {
						$("#result").text(response.responseText);
					}
				});
			}
			
			function CreateTask()
			{
				$("#result").text("");
			
				var key = $("#key").val();
				//any parameters provided INSIDE the task xml are meant to be saved as part of the task *definition* - ie: 'defaults'.
				var task_xml = packJSON($("#create_task_xml").val());
				
				$.ajax({
					async: false,
					type: "POST",
					url: "pages/api.ashx?action=CreateTask&key=" + key + "&timestamp=2011-12-20T13%3A58%3A14&signature=35227d3e20098ccc8c4a87f4b1aa493d153d72ad736c792e193cacc152c34079",
					data: 'TaskXML=' + task_xml,
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					success: function (msg) {
						$("#result").text(msg.d);    	
					},	
					error: function (response) {
						$("#result").text(response.responseText);
					}
				});
			
			}

		</script>
	</head>
	<body>
	This is a test page for the new API functions in Cato.  Currently has hardcoded values for unit testing.
	<p>
		This is the KEY passed with all the API calls.
		<input id="key" type="text" value="12-34-56-78-90" />
	</p>
	
	<button onclick="HelloWorld()">Hello World</button>
	
	<p>
		CREATE TASK<br />
		Put the task xml in this field:<br />
		<textarea id="create_task_xml" cols="80" rows="10"></textarea>
		<br />
		<button onclick="CreateTask()">Create Task</button>
	</p>

	<p>
		STOP TASK<br />
		Instance: <input id="stop_task_instance" type="text" />
		<button onclick="StopTask()">Stop Task</button>
	</p>	

	<p>
		GET TASK and RUN TASK<br />
		TaskID: <input id="get_task_id" type="text" value="66d3a971-e756-4164-ac52-92c157cadadb" />
		<button onclick="GetTask()">Get Task</button>
		<button onclick="RunTask()">Run Task</button>
	</p>
	
	<pre>
		<div id="result"></div>
	</pre>
	</body>
</html>
